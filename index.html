<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üß†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
html, body { height: 100%; margin: 0; }
body {
  display: grid; place-items: center;
  background: #000; color: white;
  font-family: Arial, sans-serif; text-align: center;
}
#gameContainer {
  width: 90%; max-width: 700px; min-height: 520px;
  padding: 20px; background: #000; border-radius: 15px;
  box-shadow: 0 0 25px rgba(255,255,255,0.08);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
h1 { font-size: 1.8em; margin-bottom: 20px; color: #4dd0e1; font-family: 'Press Start 2P', cursive; }

#task, #wordDisplay {
  font-size: 1.4em; margin: 20px 0; min-height: 50px;
  font-family: 'Press Start 2P', cursive;
}

#playerWord, #answer {
  width: 80%; max-width: 400px;
  padding: 10px; border-radius: 10px; border: none;
  text-align: center;
}

button {
  padding: 12px 25px;
  border-radius: 10px;
  background: #2e7d32;
  color: white;
  border: none;
}

#board {
  display: grid;
  grid-template-columns: repeat(3, 120px);
  grid-template-rows: repeat(3, 120px);
  gap: 12px;
}

.cell {
  width:120px; height:120px;
  display:flex; align-items:center; justify-content:center;
  font-size:48px; border-radius:15px;
}

/* ? BUTTON */
#tipButton {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: none;
  border: none;
  color: white;
  font-size: 28px;
  cursor: pointer;
}

.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
}

.modal-content {
  background: #111;
  margin: 15% auto;
  padding: 20px;
  border-radius: 12px;
  width: 80%;
  max-width: 400px;
}

.close { float:right; font-size:28px; cursor:pointer; }
</style>
</head>

<body>

<div id="gameContainer">
  <h1>üß†</h1>
  <button onclick="startWordChain()">START</button>
</div>

<!-- ? Button -->
<button id="tipButton">?</button>
<div id="tipModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <p id="tipText"></p>
  </div>
</div>

<script>
// ================= VARIABLEN =================
let stage='start', wordScore=0;
let currentWord='', usedWords=[], wordList=[];
let board=[], gameOver=false;

// ================= TIPPS =================
const tips = {
  start: "Starte das Spiel mit START.",
  word: "Neues Wort muss mit dem letzten Buchstaben beginnen.",
  tic: "Blockiere die AI und versuche 3 in einer Reihe."
};

// ================= ? LOGIC =================
const tipButton=document.getElementById('tipButton');
const tipModal=document.getElementById('tipModal');
const closeBtn=document.querySelector('.close');

tipButton.onclick=()=>{
  document.getElementById('tipText').innerHTML = tips[stage] || '';
  tipModal.style.display='block';
};
closeBtn.onclick=()=>tipModal.style.display='none';
window.onclick=e=>{ if(e.target===tipModal) tipModal.style.display='none'; };

// ================= WORD CHAIN =================
function startWordChain(){
  stage='word';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <div id="wordDisplay">Apple</div>
    <input id="playerWord">
    <button onclick="playWord()">OK</button>
    <div id="message"></div>
  `;
  currentWord='Apple';
  usedWords=[currentWord];
  wordList=["Apple","Elephant","Tiger","Rabbit","Tree","Eagle","Egg","Giraffe"];
}

function playWord(){
  const input=document.getElementById('playerWord');
  let word=input.value.trim();
  if(!word) return;
  if(word[0].toLowerCase()!==currentWord.slice(-1).toLowerCase()) return;
  usedWords.push(word);
  currentWord=word;
  document.getElementById('wordDisplay').textContent=word;
  wordScore++;
  input.value='';
  if(wordScore>=6) setTimeout(startTicTacToe,500);
}

// ================= TIC TAC TOE =================
function startTicTacToe(){
  stage='tic';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`<div id="board"></div>`;
  board=['','','','','','','','',''];
  renderBoard();
}

function renderBoard(){
  const b=document.getElementById('board');
  b.innerHTML='';
  board.forEach((v,i)=>{
    const d=document.createElement('div');
    d.className='cell';
    d.textContent=v;
    d.onclick=()=>{ if(!board[i]){ board[i]='X'; renderBoard(); }};
    b.appendChild(d);

    <script>
// ========================== TIC TAC TOE CONTINUED ==========================
let ticScore={player:0,ai:0,draw:0};
let timer=6, timerInterval;

function resetBoard(){
  board=['','','','','','','','',''];
  gameOver=false;
  renderBoard();
}

// KI-Logik einfach gehalten
function aiMove(){
  if(gameOver) return;
  const empty=board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
  const move=empty[Math.floor(Math.random()*empty.length)];
  board[move]='O';
  renderBoard();
}

// ========================== MATH CHALLENGE ==========================
let correctAnswer=0, correctMathCount=0, mathTimer=30, mathTimerInterval;

function startMathChallenge(){
  stage='math';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1>Math Challenge</h1>
    <div id="task"></div>
    <input id="answer" type="number" placeholder="Your answer">
    <button onclick="checkMathAnswer()">OK</button>
    <div id="timer"></div>
    <div id="message"></div>
  `;
  correctMathCount=0;
  generateMathTask();
  startMathTimer();
}

function randomInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

function generateMathTask(){
  let a=randomInt(1,20);
  let b=randomInt(1,20);
  correctAnswer=a+b;
  document.getElementById('task').textContent=`${a} + ${b} = ?`;
  document.getElementById('answer').value='';
  document.getElementById('message').textContent='';
}

function startMathTimer(){
  clearInterval(mathTimerInterval);
  mathTimer=30;
  mathTimerInterval=setInterval(()=>{
    mathTimer--;
    const d=document.getElementById('timer');
    d.textContent=`‚è≥ Time left: ${mathTimer}`;
    if(mathTimer<=0){
      clearInterval(mathTimerInterval);
      restartGame();
    }
  },1000);
}

function checkMathAnswer(){
  const input=document.getElementById('answer');
  clearInterval(mathTimerInterval);
  if(Number(input.value)===correctAnswer){
    correctMathCount++;
    document.getElementById('message').textContent='‚úÖ Correct!';
    if(correctMathCount>=3){ setTimeout(startChromaticTrial,700); return; }
    setTimeout(()=>{ generateMathTask(); startMathTimer(); },700);
  } else {
    document.getElementById('message').textContent='‚ùå Wrong!';
    correctMathCount=0;
    setTimeout(restartGame,1000);
  }
}

// ========================== CHROMATIC TRIAL ==========================
const colorsCT=["#e57373","#64b5f6","#81c784","#fff176","#f44336","#ba68c8"];
let tilesCT=[], chromaticTime=60, chromaticTimerInterval, uniformTimeout=null, solved=false;

function startChromaticTrial(){
  stage='chromatic';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1>Chromatic Trial</h1>
    <div id="grid"></div>
    <div id="timer"></div>
    <div id="message"></div>
  `;
  createChromaticGrid();
  startChromaticTimer();
}

function createChromaticGrid(){
  const grid = document.getElementById('grid');
  grid.innerHTML='';
  tilesCT=[];
  solved=false;

  for(let i=0;i<9;i++){
    const tile=document.createElement('div');
    tile.className='tile';
    const idx=Math.floor(Math.random()*colorsCT.length);
    tile.dataset.color=idx;
    tile.style.backgroundColor=colorsCT[idx];
    tile.onclick=()=>{ cycleColor(tile); checkWin(); checkUniformReset(); };
    tilesCT.push(tile);
    grid.appendChild(tile);
  }
}

function cycleColor(tile){
  if(solved) return;
  let idx=Number(tile.dataset.color);
  idx=(idx+1)%colorsCT.length;
  tile.dataset.color=idx;
  tile.style.backgroundColor=colorsCT[idx];
}

function checkWin(){
  const allGoal = tilesCT.every(t => colorsCT[Number(t.dataset.color)]===colorsCT[5]);
  if(allGoal && !solved){
    solved=true;
    clearInterval(chromaticTimerInterval);
    alert("üéâ Solved!");
    setTimeout(restartGame,500);
  }
}

function checkUniformReset(){
  const firstColor = colorsCT[Number(tilesCT[0].dataset.color)];
  const allSame = tilesCT.every(t => colorsCT[Number(t.dataset.color)]===firstColor);
  if(allSame && !solved){
    clearTimeout(uniformTimeout);
    uniformTimeout=setTimeout(()=>{ startChromaticTrial(); },2000);
  } else {
    clearTimeout(uniformTimeout);
  }
}

function startChromaticTimer(){
  clearInterval(chromaticTimerInterval);
  chromaticTime=60;
  const timerDiv=document.getElementById('timer');
  chromaticTimerInterval=setInterval(()=>{
    chromaticTime--;
    timerDiv.textContent=`‚è≥ Time left: ${chromaticTime}`;
    timerDiv.className='';
    if(chromaticTime>30) timerDiv.classList.add('timer-green');
    else if(chromaticTime>10) timerDiv.classList.add('timer-yellow');
    else timerDiv.classList.add('timer-red');
    if(chromaticTime<=0){
      clearInterval(chromaticTimerInterval);
      clearTimeout(uniformTimeout);
      restartGame();
    }
  },1000);
}

// ========================== RESTART ==========================
function restartGame(){
  clearInterval(mathTimerInterval);
  clearInterval(chromaticTimerInterval);
  clearTimeout(uniformTimeout);

  const c=document.getElementById('gameContainer');
  c.innerHTML=`<h1>üß†</h1><button onclick="startWordChain()">START</button>`;

  // Variablen zur√ºcksetzen
  stage='start';
  wordScore=0; ticScore={player:0,ai:0,draw:0};
  currentWord=''; usedWords=[]; board=[]; gameOver=false;
  correctAnswer=0; correctMathCount=0;
}
</script>
</body>
</html>
